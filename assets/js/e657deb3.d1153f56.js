"use strict";(self.webpackChunkneo_dev_portal=self.webpackChunkneo_dev_portal||[]).push([[1946],{3905:function(t,e,n){n.d(e,{Zo:function(){return d},kt:function(){return m}});var a=n(67294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var c=a.createContext({}),s=function(t){var e=a.useContext(c),n=e;return t&&(n="function"==typeof t?t(e):o(o({},e),t)),n},d=function(t){var e=s(t.components);return a.createElement(c.Provider,{value:e},t.children)},p={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},u=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,i=t.originalType,c=t.parentName,d=l(t,["components","mdxType","originalType","parentName"]),u=s(n),m=r,h=u["".concat(c,".").concat(m)]||u[m]||p[m]||i;return n?a.createElement(h,o(o({ref:e},d),{},{components:n})):a.createElement(h,o({ref:e},d))}));function m(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var c in e)hasOwnProperty.call(e,c)&&(l[c]=e[c]);l.originalType=t,l.mdxType="string"==typeof t?t:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},32649:function(t,e,n){n.r(e),n.d(e,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return d},default:function(){return u}});var a=n(87462),r=n(63366),i=(n(67294),n(3905)),o=["components"],l={},c="Invoking Smart Contracts",s={unversionedId:"n3/develop/deploy/invoke",id:"n3/develop/deploy/invoke",isDocsHomePage:!1,title:"Invoking Smart Contracts",description:"After you deployed a smart contract on the blockchain, you can then invoke it by its script hash, which is the unique identity of a smart contract. Any script changes in the contract will result in a different script hash.",source:"@site/docs/n3/develop/deploy/invoke.md",sourceDirName:"n3/develop/deploy",slug:"/n3/develop/deploy/invoke",permalink:"/website/docs/n3/develop/deploy/invoke",editUrl:"https://github.com/neo-project/neo-dev-portal/blob/master/docs/n3/develop/deploy/invoke.md",tags:[],version:"current",lastUpdatedBy:"Apisit",frontMatter:{},sidebar:"docs",previous:{title:"Deploying Smart Contracts",permalink:"/website/docs/n3/develop/deploy/deploy"},next:{title:"Deploying and Invoking Contracts",permalink:"/website/docs/n3/develop/tool/sdk/contract"}},d=[{value:"Querying the contract details",id:"querying-the-contract-details",children:[{value:"Querying using Neo-CLI",id:"querying-using-neo-cli",children:[]},{value:"Querying using Neo-GUI",id:"querying-using-neo-gui",children:[]}]},{value:"Invoking a contract",id:"invoking-a-contract",children:[{value:"Invoking a contract using Neo-CLI",id:"invoking-a-contract-using-neo-cli",children:[]},{value:"Invoking a contract using Neo-GUI",id:"invoking-a-contract-using-neo-gui",children:[]}]},{value:"Cosignature",id:"cosignature",children:[]},{value:"Invoking between contracts",id:"invoking-between-contracts",children:[{value:"Invocation permission",id:"invocation-permission",children:[]}]}],p={toc:d};function u(t){var e=t.components,n=(0,r.Z)(t,o);return(0,i.kt)("wrapper",(0,a.Z)({},p,n,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"invoking-smart-contracts"},"Invoking Smart Contracts"),(0,i.kt)("p",null,"After you deployed a smart contract on the blockchain, you can then invoke it by its script hash, which is the unique identity of a smart contract. Any script changes in the contract will result in a different script hash."),(0,i.kt)("h2",{id:"querying-the-contract-details"},"Querying the contract details"),(0,i.kt)("p",null,"You can query a contract details using Neo-CLI or Neo-GUI, such as the contract general information, methods, notifications, etc. "),(0,i.kt)("h3",{id:"querying-using-neo-cli"},"Querying using Neo-CLI"),(0,i.kt)("p",null,"Use the RPC API ",(0,i.kt)("a",{parentName:"p",href:"/website/docs/n3/reference/rpc/latest-version/api/getcontractstate"},"getcontractstate method")," to query the contract information."),(0,i.kt)("h3",{id:"querying-using-neo-gui"},"Querying using Neo-GUI"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"In Neo-GUI click ",(0,i.kt)("inlineCode",{parentName:"li"},"Contract")," ->",(0,i.kt)("inlineCode",{parentName:"li"},"Search Contract")),(0,i.kt)("li",{parentName:"ol"},"Enter the contract script hash, click  ",(0,i.kt)("inlineCode",{parentName:"li"},"Search"),".")),(0,i.kt)("p",null,"The detailed contract information is displayed in Neo-GUI. You can also view the manifest and nef files."),(0,i.kt)("h2",{id:"invoking-a-contract"},"Invoking a contract"),(0,i.kt)("h3",{id:"invoking-a-contract-using-neo-cli"},"Invoking a contract using Neo-CLI"),(0,i.kt)("p",null,"You can choose one of the following ways to invoke the contract using Neo-CLI:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Use the command invoke, which syntax is:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"invoke <scriptHash> <operation> [contractParameters=null] [sender=null] [signerAccounts=null] [maxGas=20]\n")),(0,i.kt)("p",{parentName:"li"}," For more information refer to ",(0,i.kt)("a",{parentName:"p",href:"/website/docs/n3/node/cli/cli#invoke"},"invoke"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Use the RPC API ",(0,i.kt)("a",{parentName:"p",href:"/website/docs/n3/reference/rpc/latest-version/api/invokefunction"},"invokefunction")," or ",(0,i.kt)("a",{parentName:"p",href:"/website/docs/n3/reference/rpc/latest-version/api/invokescript"},"invokescript"),". The former is recommended. "))),(0,i.kt)("h3",{id:"invoking-a-contract-using-neo-gui"},"Invoking a contract using Neo-GUI"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"In Neo-GUI click ",(0,i.kt)("inlineCode",{parentName:"p"},"Contract "),"->",(0,i.kt)("inlineCode",{parentName:"p"},"Invoke Contract"),"\u3002")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Enter the contract script hash and click ",(0,i.kt)("inlineCode",{parentName:"p"},"Search"),"."),(0,i.kt)("p",{parentName:"li"},"The methods and parameter list in the current contract are displayed.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Select the desired method, fill in the parameters and click ",(0,i.kt)("inlineCode",{parentName:"p"},"trial test"),"."),(0,i.kt)("p",{parentName:"li"},"The trial run at this step does not affect the blockchain as it is just create a NeoVM on your local computer to simulate the invocation.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"If the trial run goes smoothly and you want to invoke it on the blockchain, click ",(0,i.kt)("inlineCode",{parentName:"p"},"Invoke"),"."))),(0,i.kt)("h2",{id:"cosignature"},"Cosignature"),(0,i.kt)("p",null,"Some contracts require multiple signatures when invoked, one of which is the signature of the transaction initiator to support the fee, and the rest are cosignatures."),(0,i.kt)("p",null,"When writing a contract, we usually use ",(0,i.kt)("inlineCode",{parentName:"p"},"Runtime.CheckWitness (owner)")," to authenticate the caller  address, where ",(0,i.kt)("inlineCode",{parentName:"p"},"owner")," is the address allowed to be invoked, and the parameter type is ",(0,i.kt)("inlineCode",{parentName:"p"},"ByteArray"),". Invoking the contract with an unspecified address will fail. For example, when updating a contract, the owner here is the contract administrator. When transferring assets, the owner here is the sender (payer)."),(0,i.kt)("p",null,"When ",(0,i.kt)("inlineCode",{parentName:"p"},"Runtime.CheckWitness (owner)")," is written in the contract, the owner's signature must be passed in as a cosignature when you invoke the contract. "),(0,i.kt)("p",null,"In Neo-CLI, you can attach a signature using the invoke command."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"invoke <scriptHash> <operation> [contractParameters=null] [sender=null]  [signerAccounts=null] [maxGas=20]\n")),(0,i.kt)("p",null,"When invoking a contract in Neo-GUI, you can click ",(0,i.kt)("inlineCode",{parentName:"p"},"Cosignature")," at the bottom of the page, choose ",(0,i.kt)("inlineCode",{parentName:"p"},"Public key"),", and then click ",(0,i.kt)("inlineCode",{parentName:"p"},"Sign")," to add the signature.  "),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"}," When you invoke the transfer method of the NEP-17 contract using the transfer command, the wallet will automatically appends the signature to the from field. You don't need to add it manually."))),(0,i.kt)("h2",{id:"invoking-between-contracts"},"Invoking between contracts"),(0,i.kt)("p",null,"In Neo N3, all contracts can be invoked dynamically, and writing a contract is much easier."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-cs"},'public class Contract1 : SmartContract\n    {\n        delegate object Dyncall(string method, object[] args);\n\n        //Use ByteArray for little endian\n        //[InitialValue("694425c17f1ebb7c65de3026c831eb4c49d6d7be", ContractParameterType.ByteArray)]\n        //private static readonly UInt160 ScriptHash;\n\n        //Use Hash160 for big endian\n        [InitialValue("0xbed7d6494ceb31c82630de657cbb1e7fc1254469", ContractParameterType.Hash160)]\n        public static UInt160 ScriptHash;\n\n        public static object Main(string operation, object[] args)\n        {\n            if (operation == "name")\n            {\n                return Contract.Call(ScriptHash, "name", CallFlags.ReadOnly, new object[0]);\n            }\n            if (operation == "totalSupply")\n            {\n                return Contract.Call(ScriptHash, "totalSupply", CallFlags.ReadOnly, new object[0]);\n            }\n            return true;\n        }\n    }\n')),(0,i.kt)("p",null,"The key statement is ",(0,i.kt)("inlineCode",{parentName:"p"},"Contract.Call(scriptHash, method, flags, params)"),", where:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"scriptHash")," is the script hash of the contract invoked. It is ByteArray type and little endian."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"method")," is the method of the contract invoked, such as  ",(0,i.kt)("inlineCode",{parentName:"li"},"name"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"balanceOf"),", or ",(0,i.kt)("inlineCode",{parentName:"li"},"transfer"),". String type."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"flags")," defines special behaviors allowed when invoking smart contracts. See ",(0,i.kt)("a",{parentName:"li",href:"https://docs.neo.org/docs/zh-cn/reference/scapi/framework/services/CallFlags.html#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"},"CallFlags Enumerator")," for details."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"params")," is the parameter list of the method of the invoked contract. Array type.")),(0,i.kt)("h3",{id:"invocation-permission"},"Invocation permission"),(0,i.kt)("p",null,"Three fields related to the contract invocation permission are defined in the contract manifest file, as shown in the following table. The wallet decides whether to give a security warning to the user based on the setting in the Groups and Trusts fields. Permissions and signature scopes determine whether contracts can be called by each other. For more information about signature scopes, refer to parameters description in ",(0,i.kt)("a",{parentName:"p",href:"/website/docs/n3/reference/rpc/latest-version/api/invokefunction"},"invokefunction method"),"."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Fields"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Groups")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ContractGroup[]")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines a group of trusted contracts, consisting of a public key and a signature of contract hash.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Permissions")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ContractPermission[]")),(0,i.kt)("td",{parentName:"tr",align:null},"This field is an array containing a permission object, which defines other contracts and methods that the contract wants to call. The contract can be ScriptHash, Group, or wildcard ",(0,i.kt)("em",{parentName:"td"},". The method is the method name or wildcard "),". Contracts or methods not declared in the manifest cannot be called by the contract.")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"Trusts")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"WildcardContainer<UInt160>")),(0,i.kt)("td",{parentName:"tr",align:null},"Defines other contracts trusted by the contract. The contract can be ScriptHash, Group, or wildcard *. If a contract is trusted, the user will not receive any warning message when the contract is called.")))),(0,i.kt)("p",null,"Assuming that the contract A calls the contract B, the following table details the invoking behavior and wallet behavior of the contract in various setting scenarios."),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Scenario"),(0,i.kt)("th",{parentName:"tr",align:null},"Wallet Prompt"),(0,i.kt)("th",{parentName:"tr",align:null},"Wallet sets signature scope to..."),(0,i.kt)("th",{parentName:"tr",align:null},"Can contract B  be invoked?"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Permissions of contract A do not include contract B"),(0,i.kt)("td",{parentName:"tr",align:null},"None"),(0,i.kt)("td",{parentName:"tr",align:null},"Default"),(0,i.kt)("td",{parentName:"tr",align:null},"No")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Permissions of contract A include contract B",(0,i.kt)("br",null),"Contract A and contract B are in the same groups and the groups signature is verified."),(0,i.kt)("td",{parentName:"tr",align:null},"None"),(0,i.kt)("td",{parentName:"tr",align:null},"Default and adds CustomGroups"),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Permissions of contract A  include contract B",(0,i.kt)("br",null),"Trusts of contract B include contract A"),(0,i.kt)("td",{parentName:"tr",align:null},"None"),(0,i.kt)("td",{parentName:"tr",align:null},"Default and adds CustomContract"),(0,i.kt)("td",{parentName:"tr",align:null},"Yes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Permissions of contract A  include contract B",(0,i.kt)("br",null),"Trusts of contract B do not include contract A"),(0,i.kt)("td",{parentName:"tr",align:null},"Prompts that contract A will call contract B, and asks whether to authorize the signature to contract B."),(0,i.kt)("td",{parentName:"tr",align:null},"Default and adds CustomContract        according to the user's decision"),(0,i.kt)("td",{parentName:"tr",align:null},"Determined by the user")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"Permissions of contract A include a Groups B"),(0,i.kt)("td",{parentName:"tr",align:null},"Prompts that contract A will call any contract in group B and asks whether to authorize the signature to group B."),(0,i.kt)("td",{parentName:"tr",align:null},"Default and adds CustomGroups according to the user's decision"),(0,i.kt)("td",{parentName:"tr",align:null},"Determined by the user")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"The contract defined in the Permissions of contract A is wildcard * and the method is m",(0,i.kt)("br",null),'{"contract":"',"*",'", "method": "m"}'),(0,i.kt)("td",{parentName:"tr",align:null},"Prompts that contract A will call the method m of any contract and asks whether to authorize the signature to contract B."),(0,i.kt)("td",{parentName:"tr",align:null},"Default or Global according to the user's decision"),(0,i.kt)("td",{parentName:"tr",align:null},"Determined by the user")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"The contract defined in the Permissions of contract A is wildcard * and the method is wildcard ","*",(0,i.kt)("br",null),'{"contract":"',"*",'", "method": "',"*",'"}'),(0,i.kt)("td",{parentName:"tr",align:null},"Prompts that contract A will call any method of any contract and asks whether to set the signature to Global."),(0,i.kt)("td",{parentName:"tr",align:null},"Default or Global according to the user's decision"),(0,i.kt)("td",{parentName:"tr",align:null},"Determined by the user")))))}u.isMDXComponent=!0}}]);